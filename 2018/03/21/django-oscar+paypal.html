<!DOCTYPE html>




<html
 dir="ltr"
 lang="en"
 >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content=#ffffff>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" type="image/png"
           href="/favicon.ico" 
    />
    <script defer src="https://unpkg.com/alpinejs@3.9.0/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-social@1/bin/bulma-social.min.css">
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Django Oscar+paypal | Mosaico (Blog de Noe Nieto)</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Django Oscar+paypal" />
<meta name="author" content="Noe Nieto" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Django Oscar con Paypal" />
<meta property="og:description" content="Django Oscar con Paypal" />
<link rel="canonical" href="http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html" />
<meta property="og:url" content="http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html" />
<meta property="og:site_name" content="Mosaico (Blog de Noe Nieto)" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-21T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Django Oscar+paypal" />
<meta name="twitter:site" content="@misaelnieto_a" />
<meta name="twitter:creator" content="@Noe Nieto" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Noe Nieto"},"dateModified":"2018-03-21T00:00:00+00:00","datePublished":"2018-03-21T00:00:00+00:00","description":"Django Oscar con Paypal","headline":"Django Oscar+paypal","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html"},"url":"http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html"}</script>
<!-- End Jekyll SEO tag -->

    
<script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"nnieto",utcoffset:"-7"}))};sessionStorage.setItem("_swa","1");</script>
<!-- head scripts --></head>

  <body>
    
<nav class="navbar is-primary" >
    <div class="container">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">
                Mosaico (Blog de Noe Nieto)
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-start">
                
                
                    
                    <a href="/posts" class="navbar-item ">Posts archive</a>
                    
                
                    
                    <a href="/demos" class="navbar-item ">Demos, Tools & Toys</a>
                    
                
                    
                    <a href="https://www.noenieto.com/" class="navbar-item ">About me</a>
                    
                
                
            </div>

            <div class="navbar-end">
                
            </div>

        </div>
    </div>
</nav>

    
        <section class="hero  is-medium  is-bold is-primary" >
    <div class="hero-body ">
        <div class="container">
            <h1 class="title is-2">Django Oscar+paypal</h1>
            <p class="subtitle is-3"></p>
            
        </div>
    </div>
</section>
    
    


    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                
                <div class="column is-12">
                    
                    
                    
                    
                    <div class="content">

    <p>Published: Mar 21, 2018 by Noe Nieto</p>

    

    <h2 id="django-oscar-con-paypal">Django Oscar con Paypal</h2>

<p>Mis notas de cómo configurar Django Oscar con paypal.</p>

<h2 id="parte-1---instalacíon-y-configuración-de-django-oscar">Parte 1 - Instalacíon y configuración de Django-Oscar</h2>

<p>Recomiendo usar un virtualenv para oscar.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkvirtualenv <span class="nt">--python</span><span class="o">=</span>python3 oscar
</code></pre></div></div>

<p>Si ya tienes un virtualenv o regresas a continuar con la tarea:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>workon oscar
</code></pre></div></div>
<p>Es momento de instalar las dependencias</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>django-oscar django-compressor
</code></pre></div></div>
<p>Luego creamos un directorio para guardar el proyecto y generamos un proyecto nuevo de Django con <code class="language-plaintext highlighter-rouge">manage.py</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> Documents/Django-Oscar/
<span class="nb">cd </span>Documents/Django-Oscar/
django-admin.py startproject frobshop
<span class="nb">cd </span>frobshop
</code></pre></div></div>

<p>Ahora procedemos a configurar el proyecto; el proceso de instalación ya esta descrito en el <a href="https://django-oscar.readthedocs.io/en/releases-1.5/internals/getting_started.html#django-settings">manual de Oscar</a>, asi que no se si valga la pena compartirlo de nuevo. El proceso se resume en que dentro de <code class="language-plaintext highlighter-rouge">frobshop</code> se modifican <code class="language-plaintext highlighter-rouge">settings.py</code> y <code class="language-plaintext highlighter-rouge">urls.py</code>. Para conveniencia, pego el contenido de los archivos directamente.</p>

<p>El archivo <code class="language-plaintext highlighter-rouge">settings.py</code> es el siguiente:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">oscar.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">oscar</span> <span class="kn">import</span> <span class="n">OSCAR_MAIN_TEMPLATE_DIR</span>
<span class="kn">from</span> <span class="nn">oscar</span> <span class="kn">import</span> <span class="n">get_core_apps</span>


<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">')_qry+6jku32tpqghn$!prp#mzb=!(d=c)jq!ezzw6!fc*a2ps'</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'django.contrib.sites'</span><span class="p">,</span>
    <span class="s">'django.contrib.flatpages'</span><span class="p">,</span>
    <span class="s">'compressor'</span><span class="p">,</span>
    <span class="s">'widget_tweaks'</span><span class="p">,</span>
<span class="p">]</span><span class="o">+</span> <span class="n">get_core_apps</span><span class="p">()</span>
<span class="n">SITE_ID</span><span class="o">=</span><span class="mi">1</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.middleware.security.SecurityMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.common.CommonMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="p">,</span>
    <span class="s">'oscar.apps.basket.middleware.BasketMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.flatpages.middleware.FlatpageFallbackMiddleware'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">'frobshop.urls'</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'BACKEND'</span><span class="p">:</span> <span class="s">'django.template.backends.django.DjangoTemplates'</span><span class="p">,</span>
        <span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">),</span>
            <span class="n">OSCAR_MAIN_TEMPLATE_DIR</span>
        <span class="p">],</span>
        <span class="s">'APP_DIRS'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">'OPTIONS'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'context_processors'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">'django.template.context_processors.debug'</span><span class="p">,</span>
                <span class="s">'django.template.context_processors.request'</span><span class="p">,</span>
                <span class="s">'django.contrib.auth.context_processors.auth'</span><span class="p">,</span>
                <span class="s">'django.template.context_processors.i18n'</span><span class="p">,</span>
                <span class="s">'django.contrib.messages.context_processors.messages'</span><span class="p">,</span>
                <span class="s">'oscar.apps.search.context_processors.search_form'</span><span class="p">,</span>
                <span class="s">'oscar.apps.promotions.context_processors.promotions'</span><span class="p">,</span>
                <span class="s">'oscar.apps.checkout.context_processors.checkout'</span><span class="p">,</span>
                <span class="s">'oscar.apps.customer.notifications.context_processors.notifications'</span><span class="p">,</span>
                <span class="s">'oscar.core.context_processors.metadata'</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s">'frobshop.wsgi.application'</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.sqlite3'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'db.sqlite3'</span><span class="p">),</span>
        <span class="s">'ATOMIC_REQUESTS'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.MinimumLengthValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.CommonPasswordValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.NumericPasswordValidator'</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'en-us'</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">'UTC'</span>
<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">AUTHENTICATION_BACKENDS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'oscar.apps.customer.auth_backends.EmailBackend'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth.backends.ModelBackend'</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'static'</span><span class="p">)</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">'/static/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'media'</span><span class="p">)</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">'/media/'</span>

<span class="n">HAYSTACK_CONNECTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'haystack.backends.simple_backend.SimpleEngine'</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">OSCAR_INITIAL_ORDER_STATUS</span> <span class="o">=</span> <span class="s">'Pending'</span>
<span class="n">OSCAR_INITIAL_LINE_STATUS</span> <span class="o">=</span> <span class="s">'Pending'</span>
<span class="n">OSCAR_ORDER_STATUS_PIPELINE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'Pending'</span><span class="p">:</span> <span class="p">(</span><span class="s">'Being processed'</span><span class="p">,</span> <span class="s">'Cancelled'</span><span class="p">,),</span>
    <span class="s">'Being processed'</span><span class="p">:</span> <span class="p">(</span><span class="s">'Processed'</span><span class="p">,</span> <span class="s">'Cancelled'</span><span class="p">,),</span>
    <span class="s">'Cancelled'</span><span class="p">:</span> <span class="p">(),</span>
<span class="p">}</span>
</code></pre></div></div>

<p>El archivo <code class="language-plaintext highlighter-rouge">urls.py</code> queda asi:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">oscar.app</span> <span class="kn">import</span> <span class="n">application</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^i18n/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'django.conf.urls.i18n'</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">application</span><span class="p">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Ya tenemos toda la configuración; El siguiente paso es crear la base de datos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py migrate
</code></pre></div></div>

<p>La creación de la base de datos es un proceso un poco largo, pero se ve parecido a esto:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>oscar<span class="o">)</span> <span class="o">[</span>nnieto@3c273 frobshop] <span class="nv">$ </span>./manage.py migrate
Operations to perform:
  Apply all migrations: address, admin, analytics, auth, basket, catalogue, contenttypes, customer, flatpages, offer, order, partner, payment, promotions, reviews, sessions, shipping, sites, thumbnail, voucher, wishlists
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying address.0001_initial... OK
  <span class="o">[</span> ...] 
  Applying sites.0002_alter_domain_unique... OK
  Applying thumbnail.0001_initial... OK
  Applying voucher.0002_auto_20170418_2132... OK
  Applying wishlists.0001_initial... OK
  Applying wishlists.0002_auto_20160111_1108... OK
<span class="o">(</span>oscar<span class="o">)</span> <span class="o">[</span>nnieto@3c273 frobshop] <span class="err">$</span>
</code></pre></div></div>

<p>Luego es necesario crear un superusuario para poder entrar al dashboard/panel de control de Oscar.</p>

<p>./manage.py createsuperuser</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(oscar) [nnieto@3c273 frobshop] $ ./manage.py createsuperuser
Username (leave blank to use 'nnieto'): admin
Email address: nnieto@noenieto.com
Password: 
Password (again): 
Superuser created successfully.

</code></pre></div></div>

<p>La guia dice que es buena idea crear la lista de paises. Esta lista se usa para cuando el cliente llena el formulario de dirección de envío.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py oscar_populate_countries
</code></pre></div></div>

<p>Ahora es momento de arrancar Django:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py runserver
</code></pre></div></div>

<p>Y aqui tienes, una tienda de Oscar recien creada:</p>

<p><img src="/media/Screenshot-2018-3-21 Oscar -.png" alt="Oscar sabor vainilla" /></p>

<h2 id="parte-2---instalación-y-configuración-del-plugin-de-paypal">Parte 2 - Instalación y configuración del plugin de PayPal</h2>

<p>El nombre del paquete/Wheel es <code class="language-plaintext highlighter-rouge">django-oscar-paypal</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>django-oscar-paypal
</code></pre></div></div>
<p>Nota: Este modulo tiene dos metodos de pago: <em>Express Checkout</em> y <em>PayFlow Pro</em>. En esta ocasión solo voy a usar <em>Express Checkout</em>.</p>

<p>Ahora es el momento de hacer la configuración del modulo de pagos para paypal. Primero modificamos <code class="language-plaintext highlighter-rouge">settings.py</code> y agregamos hasta abajo lo siguiente:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INSTALLED_APPS</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'paypal'</span><span class="p">)</span>
<span class="n">PAYPAL_API_USERNAME</span> <span class="o">=</span> <span class="s">'test_xxxx.gmail.com'</span>
<span class="n">PAYPAL_API_PASSWORD</span> <span class="o">=</span> <span class="s">'123456789'</span>
<span class="n">PAYPAL_API_SIGNATURE</span> <span class="o">=</span> <span class="s">'A93x6mGy1E8MD85gDtAMJnvfVBZxBYE96KO1aoRnPezYvM4OGPaxNhAjB'</span>
</code></pre></div></div>

<p>Voy a usar la consola de paypal para hacer las pruebas con el entorno <em>sandbox</em>. Primero hay que entrar a la consola de paypal para desarrolladores en https://developer.paypal.com/ . Es recomendable crear al menos dos usuarios en <em>Sandbox</em>-&gt;<em>Accounts</em>. Asegurate que el usuario que vas a usar como vendedor sea usuario <em>Business</em> por que los usuarios personales no tienen credenciales para uso del API.</p>

<p>El email, la contraseña y la firma para el API los encuentras abriendo el perfil de usuario.</p>

<p><img src="/media/Screenshot-2018-3-25 Sandbox accounts - PayPal Developer.png" alt="Primero abre el usuario" /></p>

<p><img src="/media/Screenshot-2018-3-25 Sandbox accounts - PayPal Developer(1).png" alt="Luego encontrarás las credenciales" /></p>

<p>Despues de esto hay que modificar <code class="language-plaintext highlighter-rouge">urls.py</code> para agregar las urls de la aplicacion de paypal. El archivo queda asi:</p>

<p>``python
from django.conf.urls import include, url
from django.contrib import admin
from oscar.app import application as oscar_app
from paypal.express.dashboard.app import application as paypal_app</p>

<p>urlpatterns = [
    url(r’^i18n/’, include(‘django.conf.urls.i18n’)),
    url(r’^admin/’, admin.site.urls),
    url(r’^checkout/paypal/’, include(‘paypal.express.urls’)),
    url(r’^dashboard/paypal/express/’, include(paypal_app.urls)),
    url(r’’, include(oscar_app.urls)),
]</p>

<p>``</p>

<p>El modulo de paypal tiene una pagina de reporte de transacciones. Sera muy util si incluimos un link a esa pagina desde el dashboard. Esto se logra agregando un elemento mas a <code class="language-plaintext highlighter-rouge">OSCAR_DASHBOARD_NAVIGATION</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="n">OSCAR_DASHBOARD_NAVIGATION</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s">'label'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">'Payments'</span><span class="p">),</span>
        <span class="s">'icon'</span><span class="p">:</span> <span class="s">'icon-globe'</span><span class="p">,</span>
        <span class="s">'children'</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">'label'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">'Paypal Express transactions'</span><span class="p">),</span>
                <span class="s">'url_name'</span><span class="p">:</span> <span class="s">'paypal-express-list'</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Lo que sigue es modificar la plantilla del carrito para que aparezca el boton de pago con paypal. Pero primero hay que crear el directorio para las plantillas:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">pwd</span>
/home/nnieto/Code/Django-Oscar/frobshop_paypal
<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> templates/basket/partials/
</code></pre></div></div>

<p>Hay que crear la plantilla <code class="language-plaintext highlighter-rouge">templates/basket/partials/basket_content.html</code> con el siguiente contenido:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s">'oscar/basket/partials/basket_content.html'</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">i18n</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">url</span> <span class="k">from</span> <span class="n">future</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">formactions</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"form-actions"</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">anon_checkout_allowed</span> <span class="ow">or</span> <span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">is_authenticated</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{% url 'paypal-redirect' %}"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">"https://www.paypal.com/en_US/i/btn/btn_xpressCheckout.gif"</span> <span class="n">align</span><span class="o">=</span><span class="s">"left"</span> <span class="n">style</span><span class="o">=</span><span class="s">"margin-right:7px;"</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{% url 'checkout:index' %}"</span> <span class="n">class</span><span class="o">=</span><span class="s">"pull-right btn btn-large btn-primary"</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s">"Proceed to checkout"</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>

</code></pre></div></div>

<p>No hay que olvidar correr las migraciones:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py migrate
</code></pre></div></div>

<p>Despues de arrancar Django podemos ver que en el dashboard ya se creó el menu <code class="language-plaintext highlighter-rouge">Payments</code>:</p>

<p><img src="/media/qjQt4Md2pm.png" alt="Ahi esta funciona." /></p>

<p>Pero todavia queda varias tareas por hacer.</p>

<ol>
  <li>Agregar un usuario para compras: pedro.perez@dominio.com</li>
  <li>Agregar un Agregar una categoria: Title: Psicohistoria</li>
  <li>Agregar un Partner: Title: default</li>
  <li>Agregar un producto:
    <ol>
      <li>Title: Bruno, Leibnitz, Vico y Thoureau</li>
      <li>UPC: BLVT</li>
      <li>Description: Lo que sea, un lorem ipsum o algo asi.</li>
      <li>Is discountable: Si</li>
      <li>Categories: Selecciona la categoria que acabas de crear.</li>
      <li>Stock and Pricing:
        <ol>
          <li>Partner: default</li>
          <li>SKU: BLVT</li>
          <li>Currency: USD</li>
          <li>Images: Sube una imagen</li>
          <li>Cost Price, Price excl. tax, Retail price: 10</li>
          <li>Variants: ninguna</li>
          <li>Upselling: nada</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<h2 id="parte-3---pruebas">Parte 3 - Pruebas</h2>

<p>Una vez terminado todo esto podemos entrar al la tienda usando la cuenta de pedro perez y abres el producto y abrimos el producto que acabamos de crear.</p>

<p><img src="/media/A8kFaYlaxL.png" alt="Listo a comprar el producto" /></p>

<p>Despues de agrgegar el producto al carrito podemos ir al carrito para ver las opciones de pago y ahi en la ezquina inferior izquierda tenemos el boton de pago de paypal. Por el momento no nos preocuparemos mucho por lo estetico ya que estamos probando funcionalidad.</p>

<p><img src="/media/Screenshot-2018-3-26 Cart Oscar -.png" alt="Ahi esta el icono amarillo de Paypal" /></p>

<p>Pero antes de hacer click en el boton amarillo de Paypal es necesario poder recibir notificaciones de Paypal directamente en mi instancia de django en localhost, y esto se hace posible gracias a <a href="https://ngrok.com/">ngrok</a>. <code class="language-plaintext highlighter-rouge">ngrok</code> es un servicio gratuito para pruebas de este tipo. Y configurarlo es bastante fácil: <code class="language-plaintext highlighter-rouge">./ngrok</code>.</p>

<p><img src="/media/Screenshot from 2018-03-26 19-14-54.png" alt="ngrok haciendo un tunel." /></p>

<p>Nota: hay que agregar 5603f7b3.ngrok.io a la lista de  ALLOWED_HOSTS por que si no Django va a fallar con el error <code class="language-plaintext highlighter-rouge">DisallowedHost at /</code>.</p>

<p>Ahora si, ya todo esta listo para hacer el pago, presionemos el botón de Paypal y nos vamos a la pantalla de 
login del sandbox de Paypal.</p>

<p><img src="/media/Screenshot-2018-3-26 Pagar con mi cuenta PayPal - PayPal(1).png" alt="Hay que usar alguna cuenta creada en la consola de pruebas de Paypal." /></p>

<p>Para poder pagar hay que usar alguna cuenta creada en la consola de pruebas de Paypal. Despues de hacer login pasamos a revisar la informacion de cobro y pago.</p>

<p><img src="/media/Screenshot-2018-3-26 Revise su información.png" alt="Ultima revision antes de pagar." /></p>

<p>Despues de presionar el boton amarillo de Continuar, paypal nos redirigirá de regreso a la tienda:</p>

<p><img src="/media/Screenshot-2018-3-26 Order preview Checkout Oscar -.png" alt="De regreso a Oscar" /></p>

<p>Ya solo falta presionar el boton azul de <em>Place Order</em> y el proceso de compra y pago ha terminado.</p>

<p>Pheww!</p>

</div>

<div class="tags">
    
      <span class="tag  is-primary ">
    django
</span>
    
      <span class="tag  is-primary ">
    ecommerce
</span>
    
      <span class="tag  is-primary ">
    django-oscar
</span>
    
      <span class="tag  is-primary ">
    paypal
</span>
    
      <span class="tag  is-primary ">
    español
</span>
    
</div>


<p><strong>Share</strong></p>
<div class="buttons ">
    <a class="button is-medium is-facebook"
       onclick="window.open('https://www.facebook.com/share.php?u=http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html');">
        <span class="icon"><i class="fab fa-facebook fa-lg"></i></span>
    </a>
    <a class="button is-medium is-twitter"
       onclick="window.open('https://twitter.com/intent/tweet?text=http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html');">
        <span class="icon"><i class="fab fa-twitter fa-lg"></i></span>
    </a>
    <a class="button is-medium is-linkedin"
       onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html&title=Django+Oscar%2Bpaypal&summary=&source=');">
        <span class="icon"><i class="fab fa-linkedin fa-lg"></i></span>
    </a>
    <a class="button is-medium is-reddit"
       onclick="window.open('https://reddit.com/submit?url=http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html');">
        <span class="icon"><i class="fab fa-reddit fa-lg"></i></span>
    </a>
</div>



  

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html';
      this.page.identifier = 'http://blog.noenieto.com/2018/03/21/django-oscar+paypal.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://noenieto.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



                </div>
                
            </div>
        </div>
    </section>
    
        <footer class="footer">
    <div class="container">
        
        
        <div class="columns is-multiline">
            
        </div>
        

        <div class="content is-small has-text-centered">
            <p class="">Theme built by <a href="https://www.csrhymes.com">C.S. Rhymes</a></p>
        </div>
    </div>
</footer>

    
    <script src="/assets/js/app.js" type="text/javascript"></script><!-- footer scripts --></body>
</html>
