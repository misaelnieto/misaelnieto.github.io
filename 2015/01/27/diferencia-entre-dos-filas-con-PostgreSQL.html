<!DOCTYPE html>




<html
 dir="ltr"
 lang="en"
 >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content=#ffffff>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" type="image/png"
           href="/favicon.ico" 
    />
    <script defer src="https://unpkg.com/alpinejs@3.9.0/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-social@1/bin/bulma-social.min.css">
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Cómo sacar la diferencia entre dos filas con PostgreSQL | Mosaico (Blog de Noe Nieto)</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Cómo sacar la diferencia entre dos filas con PostgreSQL" />
<meta name="author" content="Noe Nieto" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Noe Nieto es instructor de Psicología Holokinética. Se graduó de ingeniero en Electrónica en el Instituto Tecnológico de Puebla y ahora cursa la Maestría en Ingeniería en la Universidad Autónoma de Baja California, en Mexicali, Baja California, México. Tiene más de 10 años de experiencia usando Linux todos los dias y es entusiasta del Software Libre" />
<meta property="og:description" content="Noe Nieto es instructor de Psicología Holokinética. Se graduó de ingeniero en Electrónica en el Instituto Tecnológico de Puebla y ahora cursa la Maestría en Ingeniería en la Universidad Autónoma de Baja California, en Mexicali, Baja California, México. Tiene más de 10 años de experiencia usando Linux todos los dias y es entusiasta del Software Libre" />
<link rel="canonical" href="http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html" />
<meta property="og:url" content="http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html" />
<meta property="og:site_name" content="Mosaico (Blog de Noe Nieto)" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-01-27T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cómo sacar la diferencia entre dos filas con PostgreSQL" />
<meta name="twitter:site" content="@misaelnieto_a" />
<meta name="twitter:creator" content="@Noe Nieto" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Noe Nieto"},"dateModified":"2015-01-27T00:00:00+00:00","datePublished":"2015-01-27T00:00:00+00:00","description":"Noe Nieto es instructor de Psicología Holokinética. Se graduó de ingeniero en Electrónica en el Instituto Tecnológico de Puebla y ahora cursa la Maestría en Ingeniería en la Universidad Autónoma de Baja California, en Mexicali, Baja California, México. Tiene más de 10 años de experiencia usando Linux todos los dias y es entusiasta del Software Libre","headline":"Cómo sacar la diferencia entre dos filas con PostgreSQL","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html"},"url":"http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html"}</script>
<!-- End Jekyll SEO tag -->

    
<script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"nnieto",utcoffset:"-7"}))};sessionStorage.setItem("_swa","1");</script>
<!-- head scripts --></head>

  <body>
    
<nav class="navbar is-primary" >
    <div class="container">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">
                Mosaico (Blog de Noe Nieto)
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-start">
                
                
                    
                    <a href="/posts" class="navbar-item ">Posts archive</a>
                    
                
                    
                    <a href="/demos" class="navbar-item ">Demos, Tools & Toys</a>
                    
                
                    
                    <a href="https://www.noenieto.com/" class="navbar-item ">About me</a>
                    
                
                
            </div>

            <div class="navbar-end">
                
            </div>

        </div>
    </div>
</nav>

    
        <section class="hero  is-medium  is-bold is-primary" >
    <div class="hero-body ">
        <div class="container">
            <h1 class="title is-2">Cómo sacar la diferencia entre dos filas con PostgreSQL</h1>
            <p class="subtitle is-3"></p>
            
        </div>
    </div>
</section>
    
    


    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                
                <div class="column is-12">
                    
                    
                    
                    
                    <div class="content">

    <p>Published: Jan 27, 2015 by Noe Nieto</p>

    

    <p><img src="/media/401930619_c6ce5e6f54_o.jpg" alt="Elefantote" /></p>

<p>Tengo una tabla muy simple donde se guardan mediciones. Cada fila corresponde
a una medición y cada fila tiene una columna con el ID.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">history</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">SERIAL</span><span class="p">,</span>
  <span class="n">conteo</span> <span class="nb">INT</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Ahora insertaré algunos datos.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">history</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">43</span><span class="p">),</span> <span class="p">(</span><span class="mi">63</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="p">(</span><span class="mi">41</span><span class="p">)</span> <span class="p">,(</span><span class="mi">85</span><span class="p">);</span>
</code></pre></div></div>

<p>Necesito calcular qué tanto ha cambiado el valor de conteo de una columna con
respecto a la columna anterior. ¿Cómo se hace eso? La respuesta es más
sencilla de lo que me imaginé. Este es uno de esos casos donde se puede hacer
un JOIN de la tabla consigo misma. Esto en inglés se le llama <em>Self-join</em>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Y</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Y</span><span class="p">.</span><span class="n">conteo</span><span class="o">-</span> <span class="n">X</span><span class="p">.</span><span class="n">conteo</span> <span class="k">AS</span> <span class="nv">"Diferencia"</span>
<span class="k">FROM</span> <span class="n">history</span> <span class="n">X</span>
<span class="k">JOIN</span> <span class="n">history</span> <span class="n">Y</span> <span class="k">ON</span> <span class="n">X</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="p">(</span><span class="n">Y</span><span class="p">.</span><span class="n">id</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Y</span><span class="p">.</span><span class="n">id</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div></div>

<p>La solución, en este caso especifico, consiste en aprovechar que la columna ID
es un numero entero que crece conforme se van insertando columnas. Simplemente
se busca que el id de la columna anterior sea equivalente al de la columna
actual menos uno.</p>

<p>El resultado es este:</p>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th style="text-align: center">DIFERENCIA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>5</td>
      <td style="text-align: center">44</td>
    </tr>
    <tr>
      <td>4</td>
      <td style="text-align: center">19</td>
    </tr>
    <tr>
      <td>3</td>
      <td style="text-align: center">-41</td>
    </tr>
    <tr>
      <td>2</td>
      <td style="text-align: center">20</td>
    </tr>
  </tbody>
</table>

<p>Obviamente en condiciones reales no todas las tablas tendrán un id seriado de
1 en 1. Pero si la tabla incluye la fecha y hora de la creacion de la columna
se puede usar esta columna.</p>

<p>Aca dejo un <a href="http://sqlfiddle.com/#!15/76b2a/6">SQLFiddle</a> para que puedas jugar con los datos.</p>

<hr />

<ul>
  <li>La imagen del elefante la tomé de <a href="https://flic.kr/p/BvZYg">https://flic.kr/p/BvZYg</a></li>
</ul>

</div>

<div class="tags">
    
</div>


<p><strong>Share</strong></p>
<div class="buttons ">
    <a class="button is-medium is-facebook"
       onclick="window.open('https://www.facebook.com/share.php?u=http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html');">
        <span class="icon"><i class="fab fa-facebook fa-lg"></i></span>
    </a>
    <a class="button is-medium is-twitter"
       onclick="window.open('https://twitter.com/intent/tweet?text=http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html');">
        <span class="icon"><i class="fab fa-twitter fa-lg"></i></span>
    </a>
    <a class="button is-medium is-linkedin"
       onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html&title=C%C3%B3mo+sacar+la+diferencia+entre+dos+filas+con+PostgreSQL&summary=&source=');">
        <span class="icon"><i class="fab fa-linkedin fa-lg"></i></span>
    </a>
    <a class="button is-medium is-reddit"
       onclick="window.open('https://reddit.com/submit?url=http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html');">
        <span class="icon"><i class="fab fa-reddit fa-lg"></i></span>
    </a>
</div>



  

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html';
      this.page.identifier = 'http://blog.noenieto.com/2015/01/27/diferencia-entre-dos-filas-con-PostgreSQL.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://noenieto.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



                </div>
                
            </div>
        </div>
    </section>
    
        <footer class="footer">
    <div class="container">
        
        
        <div class="columns is-multiline">
            
        </div>
        

        <div class="content is-small has-text-centered">
            <p class="">Theme built by <a href="https://www.csrhymes.com">C.S. Rhymes</a></p>
        </div>
    </div>
</footer>

    
    <script src="/assets/js/app.js" type="text/javascript"></script><!-- footer scripts --></body>
</html>
