<!DOCTYPE html>




<html
 dir="ltr"
 lang="en"
 >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content=#ffffff>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" type="image/png"
           href="/favicon.ico" 
    />
    <script defer src="https://unpkg.com/alpinejs@3.9.0/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-social@1/bin/bulma-social.min.css">
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Writing widgets for zope.formlib | Mosaico (Blog de Noe Nieto)</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Writing widgets for zope.formlib" />
<meta name="author" content="Noe Nieto" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="WARNING This post is incomplete." />
<meta property="og:description" content="WARNING This post is incomplete." />
<link rel="canonical" href="http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html" />
<meta property="og:url" content="http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html" />
<meta property="og:site_name" content="Mosaico (Blog de Noe Nieto)" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-03-10T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Writing widgets for zope.formlib" />
<meta name="twitter:site" content="@misaelnieto_a" />
<meta name="twitter:creator" content="@Noe Nieto" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Noe Nieto"},"dateModified":"2012-03-10T00:00:00+00:00","datePublished":"2012-03-10T00:00:00+00:00","description":"WARNING This post is incomplete.","headline":"Writing widgets for zope.formlib","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html"},"url":"http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html"}</script>
<!-- End Jekyll SEO tag -->

    
<script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"nnieto",utcoffset:"-7"}))};sessionStorage.setItem("_swa","1");</script>
<!-- head scripts --></head>

  <body>
    
<nav class="navbar is-primary" >
    <div class="container">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">
                Mosaico (Blog de Noe Nieto)
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-start">
                
                
                    
                    <a href="/posts" class="navbar-item ">Posts archive</a>
                    
                
                    
                    <a href="/demos" class="navbar-item ">Demos, Tools & Toys</a>
                    
                
                    
                    <a href="https://www.noenieto.com/" class="navbar-item ">About me</a>
                    
                
                
            </div>

            <div class="navbar-end">
                
            </div>

        </div>
    </div>
</nav>

    
        <section class="hero  is-medium  is-bold is-primary" >
    <div class="hero-body ">
        <div class="container">
            <h1 class="title is-2">Writing widgets for zope.formlib</h1>
            <p class="subtitle is-3"></p>
            
        </div>
    </div>
</section>
    
    


    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                
                <div class="column is-12">
                    
                    
                    
                    
                    <div class="content">

    <p>Published: Mar 10, 2012 by Noe Nieto</p>

    

    <p><strong>WARNING</strong> This post is incomplete.</p>

<p>I’m doing some interesting things on Grok. Sometimes you need to customize the
default widgets that zope.formlib gives you. So, hopefully, this guide will
summarize it.</p>

<h2 id="intro">Intro</h2>

<p>On this blog post, I’m trying to clarify how does zope.formlib works and how
to make custom widgets for web apps.</p>

<p>My background is Electronics Engineering, and sometimes I have trouble with
some concepts on the Computer Science field. If you find something misleading
or wrong/stupid, I encorage you to drop a comment. I will appreciate it.</p>

<p>Finally, some examples are targeted towards the <a href="http://grok.zope.org/">Grok</a>
framework. But is very likely that with proper porting, the examples will run
as well on <a href="http://bluebream.zope.org/">BlueBream</a> or maybe Plone.</p>

<h2 id="the-zca-and-how-does-stuff-is-glued-together">The ZCA and how does stuff is glued together</h2>

<p>Where do we start? Let’s try <a href="http://www.muthukadan.net/docs/zca.html">A comprehensive Guide to Zope Component
Architecture</a>. This guide shows you
how do the basic building blocks of Zope works.</p>

<p>According to the author, the ZCA is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...] a Python framework for supporting component based design and programming. It is very well suited to developing large Python software systems. The ZCA is not specific to the Zope web application server: it can be used for developing any Python application. Maybe it should be called as Python Component Architecture.
</code></pre></div></div>

<p>And yes, the ZCA is used in several software projects outside Zope.</p>

<p>One of the most common use cases for the ZCA is doing some kind of
<a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> along
with <a href="http://zodb.org/">ZODB</a>. And the main actor in this user case is the interface
(<code class="language-plaintext highlighter-rouge">zope.interface.Interface</code>). This is very important. For example, in Grok, you
use an interface for defining attribubtes of persistent objects as well as to
generate Add and Edit forms automagically.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>
<span class="kn">from</span> <span class="nn">zope</span> <span class="kn">import</span> <span class="n">schema</span>

<span class="k">class</span> <span class="nc">IFruit</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">schema</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">u</span><span class="s">'Fruit color'</span><span class="p">)</span>
</code></pre></div></div>

<p>The class IFruit defines an attribute called color. By using the fields defined in the zope.schema package, we get very useful functionality for free, like server-side validation. But, also, we can get automatic form generation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">grok</span>

<span class="k">class</span> <span class="nc">FruitEditForm</span><span class="p">(</span><span class="n">grok</span><span class="p">.</span><span class="n">EditForm</span><span class="p">):</span>
    <span class="n">grok</span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="n">IFruit</span><span class="p">)</span>
    <span class="n">form_fields</span> <span class="o">=</span> <span class="n">grok</span><span class="p">.</span><span class="n">AutoFields</span><span class="p">(</span><span class="n">IFruit</span><span class="p">)</span>
</code></pre></div></div>

<p>And, in order to leverage to this functionality, Grok resorts to
grokcore.formlib, which, in turn, uses <code class="language-plaintext highlighter-rouge">zope.formlib</code> package.</p>

<p>The <code class="language-plaintext highlighter-rouge">grok.EditForm</code> class is a specialized class which inherits functionality
from grok.View and some bits of <code class="language-plaintext highlighter-rouge">zope.formlib.form.EditForm</code>.</p>

<p>To save the data, the class grokcore.EditForm defines an action “Apply” (which
will be rendered as an HTML button), and is also a callback function which
will call <code class="language-plaintext highlighter-rouge">grok.EditForm.applyData()</code> with the parsed and sanitized form data
and ultimately, call <code class="language-plaintext highlighter-rouge">zope.formlib.apply_data_event()</code> and applies the form
supplied data into the context, which is the Python object that provides the
interface <code class="language-plaintext highlighter-rouge">IFruit</code>.</p>

<p>And to display the form, the thing goes like this:</p>

<ul>
  <li>
    <p>User  request a resource (e.g. <code class="language-plaintext highlighter-rouge">http://site/myfruit/edit</code>), the resource
gets mapped to the <code class="language-plaintext highlighter-rouge">FruitEditForm</code>, thanks to acquisition and the rest of the
zope machinery.</p>
  </li>
  <li>
    <p>To render the form, the <code class="language-plaintext highlighter-rouge">FruitEditForm</code> class is instantiated and provided
with context information and the corresponding request variables.</p>
  </li>
  <li>
    <p>Then, when the <code class="language-plaintext highlighter-rouge">FruitEditForm</code> it is called, first it runs the
<code class="language-plaintext highlighter-rouge">self.update_form()</code> and finally it returns to the http publishing process
whatever <code class="language-plaintext highlighter-rouge">self.render()</code> returns.</p>
  </li>
  <li>
    <p>The s<code class="language-plaintext highlighter-rouge">elf.update_form()</code> calls the <code class="language-plaintext highlighter-rouge">update()</code> method in all superclasses. This
is because the forms defined in <code class="language-plaintext highlighter-rouge">zope.formlib</code> have update and <code class="language-plaintext highlighter-rouge">render()</code> methods
with different context than what grok provides them.</p>

    <ul>
      <li>Eventually, python will execute the code in the <code class="language-plaintext highlighter-rouge">update()</code> method of
<code class="language-plaintext highlighter-rouge">zope.formlib.form.FormBase</code>. That method will execute <code class="language-plaintext highlighter-rouge">self.setupWidgets()</code>
and manipulate <code class="language-plaintext highlighter-rouge">self.form_reset</code>, <code class="language-plaintext highlighter-rouge">self.form_result</code>, <code class="language-plaintext highlighter-rouge">self.errors</code> and
<code class="language-plaintext highlighter-rouge">self.status</code>.</li>
    </ul>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">render()</code> method is implemented by the
<code class="language-plaintext highlighter-rouge">grokcore.formlib.components.GrokForm</code> class. It renders the form, either by
using a form template, or by whatever action are defined in
<code class="language-plaintext highlighter-rouge">self.form_result</code>. The <code class="language-plaintext highlighter-rouge">render()</code> method from <code class="language-plaintext highlighter-rouge">zope.formlib.form.FormBase</code> is
not executed.</p>
  </li>
</ul>

<h2 id="the-setupwidgets-method">The <code class="language-plaintext highlighter-rouge">setupWidgets()</code> method</h2>

<p>The <code class="language-plaintext highlighter-rouge">setupWidgets()</code> method is the one in charge of selecting widgets for each object <code class="language-plaintext highlighter-rouge">self.form_fields</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Takes the interface of each object of self.form_fields
</code></pre></div></div>

<p>Aquí ya me confundí.</p>

<p>Cómo se conecta un widget con un field de self.form_fields?</p>

</div>

<div class="tags">
    
</div>


<p><strong>Share</strong></p>
<div class="buttons ">
    <a class="button is-medium is-facebook"
       onclick="window.open('https://www.facebook.com/share.php?u=http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html');">
        <span class="icon"><i class="fab fa-facebook fa-lg"></i></span>
    </a>
    <a class="button is-medium is-twitter"
       onclick="window.open('https://twitter.com/intent/tweet?text=http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html');">
        <span class="icon"><i class="fab fa-twitter fa-lg"></i></span>
    </a>
    <a class="button is-medium is-linkedin"
       onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html&title=Writing+widgets+for+zope.formlib&summary=&source=');">
        <span class="icon"><i class="fab fa-linkedin fa-lg"></i></span>
    </a>
    <a class="button is-medium is-reddit"
       onclick="window.open('https://reddit.com/submit?url=http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html');">
        <span class="icon"><i class="fab fa-reddit fa-lg"></i></span>
    </a>
</div>



  

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html';
      this.page.identifier = 'http://blog.noenieto.com/2012/03/10/writing-widgets-for-zopeformlib.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://noenieto.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



                </div>
                
            </div>
        </div>
    </section>
    
        <footer class="footer">
    <div class="container">
        
        
        <div class="columns is-multiline">
            
        </div>
        

        <div class="content is-small has-text-centered">
            <p class="">Theme built by <a href="https://www.csrhymes.com">C.S. Rhymes</a></p>
        </div>
    </div>
</footer>

    
    <script src="/assets/js/app.js" type="text/javascript"></script><!-- footer scripts --></body>
</html>
